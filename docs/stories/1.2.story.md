# Story 1.2: Tab-Based Navigation Architecture

## Status
Done

## Story

**As a** planning officer,
**I want** complete tab-based navigation structure with placeholder content,
**so that** I can visualize the entire application workflow before features are implemented.

## User Context & Journey

### Primary User Goals
- **Immediate Goal**: Navigate between different views of planning application data efficiently
- **Task Flow**: Dashboard overview → Detailed comment analysis → Back to summary when needed
- **Mental Model**: Tabs represent complementary views of the same application, not separate workflows
- **Success Criteria**: User can switch between views without losing context or having to re-enter information

### Expected User Journey
1. **Entry Point**: User arrives from application list with specific application selected
2. **Default Landing**: Dashboard tab provides immediate overview and key metrics
3. **Deep Dive**: Comments tab offers detailed analysis and community feedback
4. **Context Switching**: Frequent back-and-forth between tabs during review process
5. **Exit Strategy**: Clear path back to application list or next application

### User Pain Points to Address
- **Context Loss**: Losing filters or selections when switching tabs
- **Cognitive Load**: Unclear relationship between Dashboard and Comments data
- **Orientation**: Getting lost in navigation without clear location indicators

## Acceptance Criteria

### Core Navigation (Critical UX Requirements)
1. **Tab Navigation Experience**: Tab-based routing with clear active/inactive states, smooth transitions, and preserved scroll position
2. **Layout Foundation**: Basic layout component using default Shadcn UI with consistent spacing and visual hierarchy
3. **State Continuity**: Navigation between tabs preserves all filter states, selections, and user context without data loss

### Dashboard Tab UX Requirements
4. **Dashboard Preview**: Analytics widgets and summary cards with user-benefit descriptions (not "Coming Soon" messaging)
   - Example: "Application Timeline: Track progress from submission to approval"
   - Visual hierarchy showing most important metrics first
   - Clear call-to-action areas for future interactions

### Comments Tab UX Requirements  
5. **Comments Layout Preview**: Map area, comment list, and filter controls with functional relationship indicators
   - Map and list areas show visual connection (synchronized selection states)
   - Filter controls demonstrate their effect scope
   - Clear content organization with scannable layout

### Responsive & Accessibility
6. **Multi-Device Experience**: Mobile-first responsive design with touch-friendly interactions and readable content at all breakpoints
7. **Universal Access**: Full keyboard navigation, screen reader support, and WCAG 2.1 AA compliance for all interactive elements

### User Expectations Management
8. **Progressive Enhancement**: Placeholder content uses benefit-focused messaging that educates users about upcoming functionality
   - Replace "Coming in Epic X" with "This feature will help you..."
   - Include realistic data previews where possible
   - Visual indicators show interactive vs. informational areas

## Tasks / Subtasks

- [x] Create main application layout with tab navigation (AC: 1, 2)
  - [x] Implement AppLayout.tsx component using default Shadcn UI tabs component
  - [x] Create TabNavigation.tsx for Dashboard/Comments switching
  - [x] Set up Next.js routing structure for `/dashboard/[applicationId]` and `/comments/[applicationId]`
  - [x] Configure tab state management with React Context pattern
  
- [x] Implement Dashboard tab placeholder (AC: 3)
  - [x] Create analytics widgets placeholder using default Shadcn UI card components
  - [x] Add summary cards layout using default grid system
  - [x] Include user-benefit focused messaging (not "Coming in Epic X")
  - [x] Implement responsive grid layout for different screen sizes
  
- [x] Implement Comments tab placeholder (AC: 4)
  - [x] Create map area placeholder with container styling using default Tailwind classes
  - [x] Add comment list area placeholder using default Shadcn UI list components
  - [x] Include filter controls placeholder using default Shadcn UI form components
  - [x] Structure layout for map-list synchronization placeholders
  
- [x] Ensure cross-tab state preservation (AC: 5)
  - [x] Implement tab switching with preserved filter state
  - [x] Add smooth transitions using default CSS transitions
  - [x] Configure URL state synchronization for bookmarking
  - [x] Test state persistence across navigation actions
  
- [x] Implement responsive layout (AC: 6)
  - [x] Configure mobile-first responsive design using default Tailwind breakpoints
  - [x] Test layout on desktop, tablet, and mobile viewports
  - [x] Ensure tab navigation is accessible on touch devices
  - [x] Verify proper content scaling across different screen sizes
  
- [x] Add appropriate placeholder messaging (AC: 7)
  - [x] Replace "Coming in Epic X" with user-benefit focused messaging
  - [x] Include feature descriptions for each placeholder area
  - [x] Add visual indicators for future interactive elements
  - [x] Ensure messaging is consistent across all placeholder components

## UX Design Specifications

### Interaction Design Requirements

#### Tab Navigation Behavior
**Visual States**:
- **Active Tab**: Distinct visual indicator (underline, background, or border using default Shadcn UI styling)
- **Inactive Tab**: Clear but subdued appearance with hover state feedback
- **Hover State**: Subtle visual feedback indicating clickability
- **Focus State**: Clear keyboard focus indicator for accessibility
- **Loading State**: Visual feedback during tab content loading (skeleton or spinner)

**Interaction Patterns**:
- **Click/Tap**: Immediate tab switch with smooth transition animation
- **Keyboard**: Arrow key navigation between tabs, Enter/Space to select
- **Touch**: Touch-friendly target sizes (minimum 44px) on mobile devices
- **Transition Timing**: 200-300ms smooth transition between tab content

#### Content Layout Hierarchy
**Dashboard Tab Structure**:
1. **Primary Metrics** (Top): Most critical KPIs in large, scannable format
2. **Secondary Analytics** (Middle): Supporting charts and trend data
3. **Action Items** (Bottom): Next steps and recommended actions

**Comments Tab Structure**:
1. **Filter Bar** (Top): Search and filter controls with clear labels
2. **Split View** (Main): Map (left/top) and comment list (right/bottom)
3. **Synchronization Indicators**: Visual cues showing map-list connections

#### Error Handling & Edge Cases
- **Tab Load Failure**: Error message with retry option
- **Empty States**: Helpful messaging explaining why content isn't available
- **Slow Loading**: Progressive loading with skeleton placeholders
- **Network Issues**: Offline indicators with graceful degradation

### Accessibility Specifications

#### Keyboard Navigation
- **Tab Order**: Logical sequence through all interactive elements
- **Focus Management**: Focus moves to tab content after selection
- **Escape Patterns**: Clear exit strategies from any focus trap
- **Shortcuts**: Consider Alt+1 (Dashboard), Alt+2 (Comments) shortcuts

#### Screen Reader Support  
- **Tab Labels**: Descriptive labels including current selection state
- **Content Updates**: Announce tab changes and loading states
- **Structure**: Proper heading hierarchy within each tab
- **Context**: Clear indication of current location and available actions

#### Visual Accessibility
- **Color Independence**: Information conveyed through multiple visual cues (not color alone)
- **Contrast Ratios**: Minimum 4.5:1 for normal text, 3:1 for large text
- **Text Scaling**: Readable and functional up to 200% zoom
- **Motion**: Respect user preferences for reduced motion

### Responsive Design Breakpoints

#### Mobile (320px - 768px)
- **Tab Style**: Full-width stacked tabs or horizontal scrollable tabs
- **Content**: Single-column layout with prioritized information
- **Touch Targets**: Minimum 44px tap targets with adequate spacing
- **Navigation**: Bottom or top tab bar for easy thumb access

#### Tablet (768px - 1024px)
- **Tab Style**: Horizontal tab bar with icon + label
- **Content**: Two-column layout where appropriate
- **Interactions**: Support both touch and potential keyboard/mouse

#### Desktop (1024px+)
- **Tab Style**: Full horizontal tab bar with hover states
- **Content**: Multi-column layouts with maximum information density
- **Shortcuts**: Keyboard shortcuts and advanced interactions

## Dev Notes

### Previous Story Insights
From Story 1.1 completion:
- Monorepo structure successfully established with apps/web/, packages/shared/, packages/config/
- Shadcn UI integrated with default styling and Tailwind CSS 4.1+ configured
- React Context + useReducer state management pattern implemented for FilterContext
- TypeScript interfaces properly configured in packages/shared for all data models
- Next.js 15.4.6 with proper API route structure established

### Data Models
**Filter State Management** [Source: architecture/data-models.md#filterstate]:
```typescript
interface FilterState {
  selectedPins: string[];
  sentimentFilter: SentimentType[];
  statusFilter: CommentStatus[];
  searchQuery: string;
  activeApplication: string;
  mapBounds?: MapBounds;
  isDashboardFiltered: boolean;
}
```

### Component Specifications
**App Layout Structure** [Source: architecture/frontend-architecture.md#component-organization]:
```
/src/components/
├── ui/                    // Shadcn UI base components (already configured)
├── layout/
│   ├── AppLayout.tsx      // Main application shell
│   └── TabNavigation.tsx  // Dashboard/Comments tab switching
├── dashboard/
│   ├── Analytics.tsx      // Statistics display placeholders
│   └── StatCard.tsx       // Individual statistic components
└── comments/
    ├── CommentList.tsx    // Placeholder for synchronized comment display
    └── CommentItem.tsx    // Individual comment entry placeholders
```

**Tab Navigation Component Template** [Source: architecture/frontend-architecture.md#component-template]:
- Use React functional components with TypeScript props interfaces
- Implement click handlers for tab switching with state management
- Apply default Shadcn UI tabs component without customizations
- Include proper ARIA support for accessibility

### API Specifications
**Routing Structure** [Source: architecture/frontend-architecture.md#route-organization]:
```
/src/pages/
├── index.tsx                  // Redirect to /dashboard
├── dashboard/
│   └── [applicationId].tsx    // Dashboard analytics view
└── comments/
    └── [applicationId].tsx    // Comments tab with map and list
```

### File Locations
**Component Structure** [Source: architecture/unified-project-structure.md]:
```
apps/web/src/
├── components/
│   ├── ui/         # Shadcn UI components (already configured)
│   ├── layout/     # New: Application layout components
│   ├── dashboard/  # New: Dashboard-specific placeholder components
│   └── comments/   # New: Comments-specific placeholder components
├── pages/          # Next.js pages with new routing structure
└── context/        # Existing FilterContext to be extended for tab state
```

### Technical Constraints
**UI Styling Standards** [Source: architecture/frontend-architecture.md#ui-styling-standards]:
- Use only default Shadcn UI components without any customizations to appearance or styling
- Apply only default Tailwind CSS theme without custom color palettes, spacing, or typography modifications
- No custom adjustments to component look and feel - maintain consistent default styling

**Critical Fullstack Rules** [Source: architecture/coding-standards.md#critical-fullstack-rules]:
- All filter state changes must go through centralized FilterContext for bi-directional synchronization
- Every major component (Dashboard, Comments layout) must have error boundary wrapping
- Use only default Tailwind CSS theme without custom styling modifications
- Tab navigation must preserve filter state across navigation actions

### Testing

**UX Testing Requirements** [Source: architecture/testing-strategy.md#test-organization]:

#### Usability Testing Criteria
**Task Completion Metrics**:
- Users can locate and switch between Dashboard/Comments tabs within 3 seconds
- 95% of users understand the relationship between tabs on first interaction
- Tab switching preserves user context (filters, selections) 100% of time
- Mobile users can navigate tabs with single thumb interaction

**User Comprehension Testing**:
- Users understand placeholder content represents future functionality (not broken features)
- Benefit-focused messaging communicates value proposition effectively  
- Visual hierarchy guides attention to most important information first
- Error states provide clear recovery paths

#### Accessibility Testing Requirements
**Automated Testing**:
- WAVE/axe accessibility scans with zero critical violations
- Keyboard navigation through all interactive elements
- Screen reader compatibility (NVDA, JAWS, VoiceOver)
- Color contrast validation (minimum 4.5:1 ratio)

**Manual Testing Scenarios**:
- Complete task using only keyboard navigation
- Navigate using screen reader with eyes closed
- Test at 200% zoom level on various screen sizes
- Verify reduced motion preferences are respected

#### Frontend Unit Tests
Location `apps/web/tests/components/`:
- **Tab Navigation**: Test switching behavior, active states, keyboard navigation
- **Layout Components**: Test rendering with different props, responsive breakpoints  
- **Placeholder Content**: Test user-benefit messaging display, interactive indicators
- **State Management**: Test filter preservation, context switching, error recovery

#### Integration Tests  
Location `apps/web/tests/integration/`:
- **Cross-Tab State**: Verify filter state preservation across navigation
- **Routing Integration**: Test URL synchronization with tab states
- **Performance**: Measure tab switching response times (<300ms)
- **Error Handling**: Test graceful degradation scenarios

#### E2E Tests
Location `apps/web/tests/e2e/`:
- **Complete User Journey**: Entry → Dashboard → Comments → Exit workflow
- **Multi-Device**: Test responsive behavior on mobile, tablet, desktop
- **Accessibility Workflow**: Complete tasks using assistive technologies
- **Performance**: Page load times, interaction responsiveness

**Test Organization** [Source: architecture/testing-strategy.md#test-organization]:
```
apps/web/tests/
├── components/
│   └── layout/
│       ├── AppLayout.test.tsx
│       └── TabNavigation.test.tsx
├── integration/
│   └── tab-navigation.test.tsx
└── e2e/
    └── navigation-workflow.spec.ts
```

## UX Success Metrics

### Performance Benchmarks
**Speed Requirements**:
- Tab switching response time: < 300ms
- Initial page load: < 2 seconds on 3G connection  
- Time to interactive: < 3 seconds
- Placeholder content render: < 100ms

**Usability Benchmarks**:
- Task completion rate: > 95% for tab navigation
- Error recovery rate: > 90% for failed tab switches
- User satisfaction score: > 4.0/5.0 in post-task surveys
- Mobile usability score: > 85% in mobile-specific testing

### User Experience Validation
**Behavioral Metrics**:
- Users switch between tabs at least 3 times per session (indicating value)
- < 10% of users attempt to click on placeholder areas (good messaging)
- Average time between tab switches: 15-45 seconds (active usage)
- Bounce rate from placeholder content: < 5%

**Comprehension Metrics**:
- 90% of users correctly identify tab purpose within first interaction
- 85% of users understand placeholder content represents future functionality
- Zero confusion reports about tab relationship or navigation

### Accessibility Success Criteria
**Compliance Benchmarks**:
- WCAG 2.1 AA compliance: 100% automated scan pass rate
- Keyboard navigation task completion: > 95%
- Screen reader task completion: > 90%
- High contrast mode compatibility: 100%

**Inclusive Design Validation**:
- Mobile single-thumb navigation success: > 95%
- Senior user (65+) task completion: > 85%
- Users with cognitive disabilities can complete primary tasks: > 80%

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-09 | 1.0 | Initial story creation | Scrum Master |
| 2025-01-09 | 1.1 | Enhanced comment cards with complete field structure: name, surname, email, address, sentiment, tags, redaction status, and publish functionality | Dev Agent (Claude Sonnet 4) |
| 2025-01-09 | 1.2 | Major enhancements: Dashboard analytics with real data, AI Summary section, vertical comments layout, improved container sizing, refined color coding, and UX improvements | Dev Agent (Claude Sonnet 4) |
| 2025-08-09 | 1.3 | Added Edit CTA button to comment cards with proper handler interface and outline styling | Dev Agent (Claude Sonnet 4) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4 - Full Stack Developer Agent

### Debug Log References
- TypeScript compilation errors resolved for Next.js 15 async page components
- ESLint no-explicit-any rule resolved with proper TypeScript interfaces
- Vitest globals configuration added to TypeScript config

### Completion Notes List
- Successfully implemented all AC requirements with user-benefit focused messaging
- Tab navigation preserves filter state via URL parameters and React Context
- Responsive design implemented with mobile-first approach using Tailwind breakpoints
- All components use default Shadcn UI styling without customizations
- Filter state management integrates with existing FilterContext from Story 1.1
- Enhanced comment list with complete comment cards containing all required fields:
  - Name and surname display with contact information
  - Email addresses with mail icon indicators
  - Full address information with map pin icons
  - Sentiment badges with color coding (positive=green/neutral=yellow/negative=red)
  - Tag system with 8 predefined categories with distinct colors (Use/Privacy/Light/Access/Noise/Traffic/Design/Other)
  - Visual redaction indicators for sensitive content (badge only, no card styling)
  - Publish buttons for content approval workflow
- Dashboard enhanced with real analytics data:
  - Application Analytics Overview with actual sentiment counts (Total Comments, Total Positive, Total Neutral, Total Objected)
  - Key Insights section with AI Summary title and paragraph summary emphasizing objections
  - Color-coded tag labels using consistent tag color scheme
  - Repositioned Key Insights below Analytics Overview for better information hierarchy
- Layout improvements:
  - Container width set to max-w-6xl (~1100px) with consistent px-4 padding across all pages
  - Comments page changed to vertical layout (map on top, comments below)
  - Map area enhanced with light grey background to show dimensions
  - Removed bulk operations section for cleaner interface
- Comment cards support multiple tags per comment based on content analysis
- Redacted comments show appropriate visual cues with replaced content and badge indicator
- Sample data includes realistic scenarios with various combinations of fields
- All components follow Next.js 15 client/server component patterns correctly
- Build, lint, and type checking all pass successfully
- Added Edit CTA button to comment cards positioned between View on Map and Publish buttons
- Edit button uses outline variant styling with Edit icon for consistent visual hierarchy
- Updated CommentCard props interface to include optional onEdit handler function

### File List
**New Files Created:**
- `apps/web/src/components/layout/AppLayout.tsx` - Main application layout with tab structure and 1100px container width
- `apps/web/src/components/layout/TabNavigation.tsx` - Tab navigation with state preservation
- `apps/web/src/components/layout/FilterStateLoader.tsx` - URL parameter to filter state mapping
- `apps/web/src/context/TabNavigationContext.tsx` - Tab state management context
- `apps/web/src/app/dashboard/[applicationId]/page.tsx` - Dashboard with analytics overview and AI summary
- `apps/web/src/app/comments/[applicationId]/page.tsx` - Comments tab with vertical layout and enhanced comment cards
- `apps/web/src/components/comments/CommentCard.tsx` - Complete comment card with all required fields and color coding
- `apps/web/src/components/comments/CommentList.tsx` - Comment list container component
- `apps/web/src/components/comments/CommentsSection.tsx` - Client component wrapper for comment interactions
- `apps/web/src/components/ui/badge.tsx` - Shadcn UI badge component
- `apps/web/src/lib/sampleComments.ts` - Sample comment data with all required fields
- `apps/web/src/lib/dashboardAnalytics.ts` - Analytics calculation functions for dashboard
- `tests/components/layout/AppLayout.test.tsx` - Unit tests for AppLayout component
- `tests/components/layout/TabNavigation.test.tsx` - Unit tests for TabNavigation component

**Modified Files:**
- `apps/web/src/app/layout.tsx` - Added context providers and updated metadata
- `apps/web/src/app/page.tsx` - Added redirect to dashboard for testing
- `apps/web/tsconfig.json` - Added vitest global types for testing
- `packages/shared/src/types/comments.ts` - Enhanced with name, surname, email, tags, and redaction fields
- `apps/web/src/components/comments/CommentCard.tsx` - Added Edit CTA button with outline styling and onEdit prop interface

## QA Results

### Review Date: 2025-01-09

### Reviewed By: Quinn (Senior Developer QA)

### Code Quality Assessment

The implementation demonstrates solid architectural choices and follows clean code principles. The tab-based navigation system is well-structured using proper React patterns with Context API for state management. Component organization follows logical separation with dedicated layout, dashboard, and comments modules. TypeScript interfaces are properly defined and used throughout. The code demonstrates good understanding of Next.js 15 server/client component patterns.

### Refactoring Performed

- **File**: `apps/web/src/app/dashboard/[applicationId]/page.tsx`
  - **Change**: Removed unused `commonConcerns` variable from destructuring
  - **Why**: Eliminates ESLint warning and improves code cleanliness
  - **How**: Keeps only actively used variables, reduces memory footprint

- **File**: `apps/web/src/components/layout/AppLayout.tsx`
  - **Change**: Added descriptive `aria-label` attributes to tab triggers
  - **Why**: Improves accessibility for screen readers and assistive technologies
  - **How**: Provides clear context about tab function beyond visual text

### Compliance Check

- Coding Standards: ✓ Follows React/TypeScript best practices, proper component patterns
- Project Structure: ✓ Components properly organized in layout/dashboard/comments modules  
- Testing Strategy: ✓ Unit tests implemented for core layout components with proper mocking
- All ACs Met: ✓ Tab navigation, responsive design, state preservation, and placeholder content all implemented

### Improvements Checklist

- [x] Fixed ESLint unused variable warning (apps/web/src/app/dashboard/[applicationId]/page.tsx)
- [x] Enhanced accessibility with aria-label attributes (apps/web/src/components/layout/AppLayout.tsx)
- [x] Verified responsive design implementation across breakpoints
- [x] Confirmed state preservation between tab switches via URL parameters
- [x] Validated proper use of default Shadcn UI components without customizations

### Security Review

No security concerns identified. The implementation properly handles user input through URL parameters with appropriate validation. State management uses React Context without exposing sensitive data. No direct DOM manipulation or XSS vulnerabilities detected.

### Performance Considerations

Good performance characteristics observed:
- Server-side rendering properly implemented for initial page loads
- Client-side navigation between tabs is efficient using React Context
- Filter state preservation through URL parameters reduces unnecessary re-renders
- Bundle size optimized with dynamic imports where appropriate
- Build output shows reasonable chunk sizes (100kB first load JS)

### Final Status

✓ Approved - Ready for Done

The implementation successfully meets all acceptance criteria with high code quality standards. Tab navigation works smoothly with proper state preservation, responsive design is implemented correctly, and accessibility standards are followed. All tests pass and the code builds without errors.