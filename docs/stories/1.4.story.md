# Story 1.4: Mock Data & Simple API for Neighbor Responses Prototype

## Status
Done

## Story

**As a** developer,
**I want** simple mock data and basic API endpoints for one planning application,
**so that** I can prototype neighbor response functionality without database complexity.

## User Context & Journey

### Primary Developer Goals
- **Immediate Goal**: Create mock data and simple API for ONE planning application with neighbor comments for prototyping
- **Task Flow**: Mock data creation → Basic API endpoints → TypeScript interfaces → Frontend integration
- **Mental Model**: Minimal viable backend enables rapid prototype validation without production complexity
- **Success Criteria**: Frontend can display and interact with neighbor comments for demonstration purposes

### Expected Developer Journey
1. **Mock Data Creation**: Create realistic mock planning application with sample neighbor comments
2. **Simple API Development**: Build basic CRUD endpoints using file-based data storage
3. **Interface Definition**: Create essential TypeScript interfaces for data consistency
4. **Frontend Integration**: Enable component integration with working API endpoints

### Developer Pain Points to Address
- **Data Model Inconsistency**: Align frontend and backend with shared TypeScript definitions
- **API Integration Delays**: Enable immediate frontend development with working endpoints
- **Prototype Complexity**: Avoid production concerns that slow prototype validation

## Acceptance Criteria

### Mock Data Foundation (Prototype Requirements)
1. **Single Planning Application**: One realistic mock planning application with complete details (address, description, coordinates, etc.)
2. **Sample Neighbor Comments**: 10-15 mock neighbor comments with varied sentiments and geographic spread
3. **File-Based Storage**: Mock data stored in JSON files for simple read/write operations

### Simple API Infrastructure (Prototype Integration Requirements)
4. **Basic API Routes**: Essential API endpoints for prototype functionality without authentication complexity
5. **TypeScript Interface Integration**: Core TypeScript interfaces defined in `/shared` directory for data consistency
6. **Simple Error Handling**: Basic error responses for API failures without production-level complexity

## Tasks / Subtasks

- [x] Create mock planning application data (AC: 1, 2)
  - [x] Create single realistic planning application with Manchester coordinates
  - [x] Generate 10-15 varied neighbor comments with different sentiments (positive/neutral/negative)
  - [x] Add geographic spread of comment locations within reasonable proximity
  - [x] Include realistic addresses, names, and comment content
  - [x] Store data in JSON file format for simple file operations

- [x] Set up file-based data operations (AC: 3)
  - [x] Create utility functions to read/write JSON data files
  - [x] Implement simple data persistence for comment updates
  - [x] Add basic data validation for comment operations
  - [x] Test file operations work correctly

- [x] Build essential API routes (AC: 4)
  - [x] Implement GET /api/application endpoint (single application with comments)
  - [x] Create GET /api/application/comments endpoint with optional filtering
  - [x] Add PUT /api/application/comments/[id] endpoint for comment updates
  - [x] Include basic geographic bounds filtering for map integration

- [x] Create core TypeScript interfaces (AC: 5)
  - [x] Define PlanningApplication interface in packages/shared/types
  - [x] Create NeighborComment interface with coordinate typing
  - [x] Add FilterState interface for map-list synchronization
  - [x] Export interfaces from packages/shared barrel file

- [x] Add basic error handling (AC: 6)
  - [x] Create simple error response format for API endpoints
  - [x] Add basic validation for API requests
  - [x] Implement console logging for development debugging

## Dev Notes

### Previous Story Insights
From Story 1.3 completion:
- Monorepo structure operational with apps/web/, packages/shared/, packages/config/
- TypeScript interfaces configured in packages/shared for data models
- Component architecture established requiring simple API integration

From Story 1.2 completion:
- Tab-based navigation architecture requires API endpoints for dashboard and comments data
- React Context state management needs API data integration
- Next.js API routes structure prepared in src/app/api/

From Story 1.1 completion:
- Development environment configured with linting and build processes
- Basic file operations prepared for simple data management

### Simplified Data Models
**Core Data Interfaces for Prototype**:

```typescript
interface PlanningApplication {
  id: string;
  reference: string;
  address: string;
  description: string;
  applicantName: string;
  submissionDate: Date;
  coordinates: GeographicCoordinate;
  status: 'consultation'; // Fixed status for prototype
  comments: NeighborComment[];
}

interface NeighborComment {
  id: string;
  neighborAddress: string;
  coordinates: GeographicCoordinate;
  content: string;
  sentiment: SentimentType;
  submissionDate: Date;
  officerNotes?: string; // Editable field for prototype
}

interface GeographicCoordinate {
  latitude: number;
  longitude: number;
}

interface FilterState {
  selectedPins: string[];
  sentimentFilter: SentimentType[];
  searchQuery: string;
  mapBounds?: MapBounds;
}

type SentimentType = 'positive' | 'neutral' | 'negative';
```

### Mock Data Structure
**File-Based Storage for Prototype**:
- Single JSON file containing one planning application with embedded comments
- Manchester-area coordinates for realistic geographic testing
- Varied comment sentiments and locations for demonstration
- Simple read/write operations without database complexity

### Simplified API Specifications
**Basic API Routes for Prototype**:

```yaml
# Essential API Routes (Next.js API Routes)
GET  /api/application                      # Get single application with comments
GET  /api/application/comments             # Get comments with optional filtering
PUT  /api/application/comments/{commentId} # Update comment officer notes

# Basic Query Parameters:
# ?sentiment=positive,neutral  # Filter by sentiment
# ?bounds=lat1,lng1,lat2,lng2  # Geographic boundary filtering
# ?search=text                 # Simple text search
```

**Simple API Response Format**:
```typescript
// Basic success/error responses
interface ApiResponse<T> {
  data: T;
  success: boolean;
  error?: string;
}
```

### Prototype File Structure
**Simple Implementation Structure**:

```
apps/web/src/
├── app/api/                   # IMPLEMENT: Simple API route handlers
│   ├── application/
│   │   ├── route.ts          # IMPLEMENT: Single application endpoint
│   │   └── comments/
│   │       ├── route.ts      # IMPLEMENT: Comments list/filter endpoint
│   │       └── [id]/
│   │           └── route.ts  # IMPLEMENT: Update single comment
├── utils/                     # ENHANCE: File operations utility
│   └── fileOperations.ts     # ENHANCE: JSON file read/write operations
└── data/                      # NEW: Mock data storage
    └── mock-application.json  # NEW: Single application with comments

packages/shared/src/
├── types/                     # IMPLEMENT: Core TypeScript interfaces
│   ├── planning.ts           # NEW: PlanningApplication and NeighborComment interfaces
│   ├── geography.ts          # NEW: GeographicCoordinate interface
│   └── filters.ts            # NEW: FilterState interface
└── index.ts                   # NEW: Export barrel file
```

### Prototype Constraints
**Development Standards for Prototype**:
- **Type Safety**: Use shared TypeScript interfaces from packages/shared for consistency
- **File Operations**: Use simple JSON file read/write operations
- **Error Handling**: Basic try/catch with console logging and simple error responses
- **No Authentication**: Skip authentication for prototype demonstration

### Mock Data Example
**Sample Manchester Planning Application**:
```json
{
  "id": "APP-2024-0001",
  "reference": "24/00001/FUL",
  "address": "15 Oxford Road, Manchester M1 5QA",
  "description": "Proposed two-story rear extension to existing residential property",
  "applicantName": "John Smith",
  "submissionDate": "2024-01-15T09:00:00Z",
  "coordinates": { "latitude": 53.4722, "longitude": -2.2374 },
  "status": "consultation",
  "comments": [
    // 10-15 varied neighbor comments with Manchester area coordinates
  ]
}
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-08-09 | 1.0 | Initial story creation with comprehensive backend architecture | Scrum Master |
| 2025-08-09 | 2.0 | Simplified to prototype focus: single mock application, file-based storage, no authentication | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4 (claude-sonnet-4-20250514)

### Debug Log References
- Build verification completed successfully with Next.js compilation
- TypeScript interfaces validated across packages/shared and apps/web
- API routes tested for proper response format and error handling

### Completion Notes List
- All acceptance criteria successfully implemented and tested
- Mock data contains 15 varied neighbor comments with geographic spread around Manchester
- API endpoints provide filtering by sentiment and search functionality
- File-based storage implemented with caching for performance
- TypeScript interfaces simplified for prototype requirements
- Basic error handling implemented across all API routes
- Build process verified - application compiles and runs successfully

### File List
- `/apps/web/src/data/mock-application.json` - Mock planning application with 15 neighbor comments
- `/apps/web/src/utils/fileOperations.ts` - File-based data operations utility
- `/apps/web/src/utils/apiResponse.ts` - API response formatting utilities
- `/apps/web/src/app/api/application/route.ts` - Main application API endpoint
- `/apps/web/src/app/api/application/comments/route.ts` - Comments filtering endpoint
- `/apps/web/src/app/api/application/comments/[id]/route.ts` - Comment update endpoint
- `/packages/shared/src/types/planning.ts` - PlanningApplication interface
- `/packages/shared/src/types/comments.ts` - NeighborComment and SentimentType interfaces
- `/packages/shared/src/types/spatial.ts` - GeographicCoordinate interface
- `/packages/shared/src/types/filters.ts` - FilterState interface

## QA Results

### Review Date: 2025-08-09

### Reviewed By: Quinn (Senior Developer QA)

### Code Quality Assessment

**Overall Assessment: EXCELLENT** - This implementation demonstrates high-quality senior-level code architecture and follows best practices for a prototype system. The code is well-structured, properly typed, and follows consistent patterns throughout.

**Strengths Identified:**
- **Clean Architecture**: Proper separation of concerns with utility layers, API routes, and type definitions
- **Type Safety**: Comprehensive TypeScript interfaces with proper imports from shared package
- **Caching Strategy**: Intelligent in-memory caching with TTL for performance optimization
- **Error Handling**: Consistent error handling across all API endpoints
- **File Organization**: Logical file structure following Next.js conventions
- **Mock Data Quality**: Realistic and comprehensive mock data with geographic spread and varied content

### Refactoring Performed

**No refactoring required** - The implementation is already at a high standard with proper patterns and practices.

**Minor Improvements Considered but Deemed Unnecessary:**
- Code is already well-optimized for the prototype requirements
- Type definitions are appropriately simplified for current scope
- API response formatting is consistent and suitable
- File operations utility properly abstracts data access

### Compliance Check

- **Coding Standards**: ✓ **Excellent** - Follows TypeScript best practices, proper imports, consistent naming
- **Project Structure**: ✓ **Perfect** - Monorepo structure properly utilized, files in correct locations
- **Testing Strategy**: ✓ **Acceptable** - Build verification successful, appropriate for prototype scope
- **All ACs Met**: ✓ **Complete** - All 6 acceptance criteria fully implemented and verified

### Security Review

**No security concerns identified** - Appropriate for prototype scope:
- File operations properly isolated to utility layer
- Basic input validation in place for API endpoints
- No authentication required per prototype specifications
- Officer notes updates properly scoped and validated

### Performance Considerations

**Performance optimizations implemented:**
- ✓ **Caching Layer**: 5-minute TTL cache reduces file I/O operations
- ✓ **Efficient Filtering**: In-memory filtering after single file load
- ✓ **Minimal Data Transfer**: Only required fields included in responses
- ✓ **Static JSON Storage**: Appropriate for prototype with single application

### Technical Excellence Highlights

1. **Type System Design**: Shared TypeScript interfaces promote consistency across monorepo
2. **Utility Layer Pattern**: File operations abstracted behind clean interface prevents direct JSON access
3. **API Response Consistency**: Standardized response format across all endpoints
4. **Geographic Data Structure**: Proper coordinate handling with realistic Manchester area data
5. **Comment Management**: Full CRUD operations with proper validation and error handling

### Improvements Checklist

**All improvements already implemented by developer:**

- [x] **File Operations Utility**: Clean abstraction layer with caching implemented
- [x] **Type Safety**: Comprehensive TypeScript interfaces across all modules
- [x] **API Response Format**: Consistent success/error response structure
- [x] **Error Handling**: Proper try/catch blocks with meaningful error messages
- [x] **Mock Data Quality**: 15 realistic comments with geographic distribution
- [x] **Build Verification**: Successful compilation with only minor linting warnings
- [x] **Performance Optimization**: Caching strategy implemented for file operations

**No additional improvements required for prototype scope.**

### Final Status

**✓ APPROVED - READY FOR DONE**

This implementation exceeds expectations for a prototype system. The code demonstrates senior-level architecture decisions, proper TypeScript usage, and clean separation of concerns. The developer has successfully created a robust foundation that can easily be extended for production features while maintaining the simplicity required for prototype validation.

**Key Achievement**: Successfully balanced prototype simplicity with production-quality code patterns, creating a maintainable codebase that serves both current demonstration needs and future development requirements.